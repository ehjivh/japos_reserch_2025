# アンケート調査システム - 導入手順書

## システム概要
GoogleスプレッドシートとGoogle Apps Scriptを使用したアンケート調査システムです。
会員認証後に既存データを編集可能とし、設問内容をスプレッドシートで管理します。

## 必要な構成
Google スプレッドシート（名前：アンケート調査システム）に以下の3つのシートを作成します。

### 1. 会員データシート
- シート名：会員データ
- 列構成：
  A列：会員番号（例：M001, M002...）
  B列：パスワード（例：pass123）
  C列：氏名（例：山田太郎）
  D列：メールアドレス（例：yamada@example.com）
  E列：所属（例：○○大学、△△株式会社）
  F列：性別（例：男性、女性、その他）
  G列：最終送信日時（自動記録）

### 2. 設問管理シート
- シート名：設問管理
- 列構成：
  A列：設問ID（例：Q001, Q002...）
  B列：設問タイトル（例：あなたの年代を教えてください）
  C列：設問タイプ（radio/checkbox/text）
  D列：選択肢（カンマ区切り、例：20代,30代,40代,50代以上）
  E列：必須フラグ（true/false）
  F列：表示順（1,2,3...）
  G列：表示フラグ（true/false - 設問の表示・非表示制御）

### 3. 回答データシート
- シート名：回答データ
- 列構成：
  A列：会員番号
  B列：設問ID
  C列：回答内容
  D列：回答日時

## 導入手順

### Step 1: スプレッドシートの作成
1. Google スプレッドシートを新規作成し、「アンケート調査システム」という名前を付けます
2. 上記の3つのシートを作成し、列構成を設定します
3. 各シートの1行目にヘッダーを入力します

### Step 2: サンプルデータの入力

#### 会員データシートのサンプル：
```
会員番号  パスワード  氏名      メールアドレス        所属         性別    最終送信日時
M001     pass123    山田太郎   yamada@example.com   ○○大学       男性    
M002     pass456    佐藤花子   sato@example.com     △△株式会社   女性
```

#### 設問管理シートのサンプル：
```
設問ID  設問タイトル                      設問タイプ  選択肢                           必須フラグ  表示順  表示フラグ
Q001   あなたの年代を教えてください         radio      20代,30代,40代,50代以上           true       1      true
Q002   興味のある分野を選択してください     checkbox   IT,医療,教育,環境,その他           true       2      true  
Q003   ご意見・ご要望をお聞かせください     text                                       false      3      true
Q004   非表示設問のサンプル                text                                       false      4      false
```

### Step 3: Google Apps Scriptの設定
1. スプレッドシートから「拡張機能」→「Apps Script」を開きます
2. デフォルトの`myFunction`を削除し、`Code.gs`の内容を貼り付けます
3. 「+」ボタンから「HTMLファイル」を追加し、「form」という名前で作成します
4. `form.html`の内容を貼り付けます
5. プロジェクトを保存します

### Step 4: ウェブアプリとしてデプロイ
1. 「デプロイ」→「新しいデプロイ」をクリック
2. 種類で「ウェブアプリ」を選択
3. 設定：
   - 説明：「アンケート調査システム」
   - 実行者：「自分」
   - アクセスできるユーザー：「全員」
4. 「デプロイ」をクリック
5. 承認プロセスを完了
6. 生成されたURLをコピーして保存

### Step 5: 動作確認
1. デプロイされたURLにアクセス
2. サンプルの会員番号とパスワードでログイン
3. 会員情報の編集、アンケート回答、送信まで一通りテスト
4. スプレッドシートにデータが正しく保存されることを確認

## 主な機能
- 会員番号・パスワードで認証
- 会員情報の編集
- スプレッドシートからの設問データ自動取得
- 3種類の設問タイプ対応（ラジオボタン、チェックボックス、自由記述）
- 設問の表示・非表示制御機能
- 既存回答の自動読み込み・編集
- 確認画面での回答内容確認
- スプレッドシートへのデータ保存 + 送信日時記録
- レスポンシブデザイン対応

## 設問の追加・変更方法
1. 設問管理シートで設問を追加・編集
2. 設問タイプは「radio」「checkbox」「text」のいずれかを指定
3. 選択肢はカンマ区切りで入力（textタイプの場合は空白）
4. 必須フラグは「true」または「false」で指定
5. 表示順で設問の順序を制御
6. 表示フラグで設問の表示・非表示を制御（「true」で表示、「false」で非表示、空白はtrueとして扱われる）
7. 変更後、アプリの再デプロイは不要（自動反映）

## 設問の表示・非表示制御
- 表示フラグを「false」に設定することで、設問を一時的に非表示にできます
- 非表示の設問は回答画面に表示されませんが、設問IDは保持されます
- 季節限定の設問やテスト設問などを管理する際に便利です
- 非表示設定中でも、過去の回答データは保持されます

## トラブルシューティング
- ログインできない場合：会員データシートの会員番号・パスワードを確認
- 設問が表示されない場合：設問管理シートの設定（特に表示フラグ）を確認
- データが保存されない場合：スプレッドシートの権限設定を確認
- 一部の設問のみ表示したい場合：表示フラグを利用して設問を制御

## セキュリティについて
- パスワードは平文で保存されるため、機密性の高い用途では暗号化を検討
- ウェブアプリは「全員」アクセス可能に設定されているため、URLの管理に注意
- 本格運用時はGoogle Workspaceでの利用を推奨

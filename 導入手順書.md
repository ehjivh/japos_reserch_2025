# アンケート調査システム 導入手順書

## 📋 目次
1. [システム概要](#システム概要)
2. [事前準備](#事前準備)
3. [Step 1: スプレッドシートの作成](#step-1-スプレッドシートの作成)
4. [Step 2: サンプルデータの入力](#step-2-サンプルデータの入力)
5. [Step 3: Google Apps Scriptの設定](#step-3-google-apps-scriptの設定)
6. [Step 4: ウェブアプリとしてデプロイ](#step-4-ウェブアプリとしてデプロイ)
7. [Step 5: 動作確認](#step-5-動作確認)
8. [運用開始後の管理](#運用開始後の管理)
9. [トラブルシューティング](#トラブルシューティング)

---

## システム概要

GoogleスプレッドシートとGoogle Apps Scriptを使用したアンケート調査システムです。
会員認証後に既存データを編集可能とし、設問内容をスプレッドシートで管理する柔軟なシステムです。

### 主な特徴
- ✅ 会員番号・パスワード認証
- ✅ 3つの設問タイプ（ラジオボタン、チェックボックス、自由記述）
- ✅ 設問の表示・非表示制御
- ✅ 既存回答の自動読み込み・編集
- ✅ 確認画面での内容確認
- ✅ レスポンシブデザイン対応

---

## 事前準備

### 必要なもの
- Googleアカウント（Google Workspace推奨）
- インターネット接続環境
- ウェブブラウザ（Chrome、Firefox、Edge等）

### 権限要件
- スプレッドシート作成・編集権限
- Google Apps Script実行権限
- ウェブアプリ公開権限

---

## Step 1: スプレッドシートの作成

### 1-1. 新規スプレッドシートの作成
1. [Google スプレッドシート](https://sheets.google.com)にアクセス
2. 「空白のスプレッドシート」を選択
3. スプレッドシート名を「**アンケート調査システム**」に変更

### 1-2. 必要なシートの作成
デフォルトの「シート1」を含めて、以下の3つのシートを作成します：

1. **会員データ** シート（シート1を renamed）
2. **設問管理** シート（新規作成）
3. **回答データ** シート（新規作成）

#### シートの作成手順：
1. シート1のタブを右クリック → 「名前を変更」→ 「**会員データ**」
2. 左下の「+」ボタンをクリック → 新規シートを「**設問管理**」に変更
3. 再度「+」ボタンをクリック → 新規シートを「**回答データ**」に変更

### 1-3. 各シートの列構成設定

#### 📊 会員データシート
| 列  | 項目名         | 例                 |
| --- | -------------- | ------------------ |
| A   | 会員番号       | M001, M002...      |
| B   | パスワード     | pass123            |
| C   | 氏名           | 山田太郎           |
| D   | メールアドレス | yamada@example.com |
| E   | 所属           | ○○大学             |
| F   | 性別           | 男性、女性、その他 |
| G   | 最終送信日時   | （自動記録）       |

#### 📋 設問管理シート
| 列  | 項目名       | 例                           |
| --- | ------------ | ---------------------------- |
| A   | 設問ID       | Q001, Q002...                |
| B   | 設問タイトル | あなたの年代を教えてください |
| C   | 設問タイプ   | radio, checkbox, text        |
| D   | 選択肢       | 20代,30代,40代,50代以上      |
| E   | 必須フラグ   | true, false                  |
| F   | 表示順       | 1, 2, 3...                   |
| G   | 表示フラグ   | true, false                  |

#### 💾 回答データシート
| 列  | 項目名   | 例                  |
| --- | -------- | ------------------- |
| A   | 会員番号 | M001                |
| B   | 設問ID   | Q001                |
| C   | 回答内容 | 30代                |
| D   | 回答日時 | 2025/07/13 14:30:00 |

---

## Step 2: サンプルデータの入力

### 2-1. 会員データシートの設定

1. **1行目（ヘッダー行）** に以下を入力：
```
会員番号	パスワード	氏名	メールアドレス	所属	性別	最終送信日時
```

2. **2行目以降（サンプルデータ）** に以下を入力：
```
M001	pass123	山田太郎	yamada@example.com	○○大学	男性	
M002	pass456	佐藤花子	sato@example.com	△△株式会社	女性	
M003	pass789	田中次郎	tanaka@example.com	□□研究所	男性	
```

### 2-2. 設問管理シートの設定

1. **1行目（ヘッダー行）** に以下を入力：
```
設問ID	設問タイトル	設問タイプ	選択肢	必須フラグ	表示順	表示フラグ
```

2. **2行目以降（サンプルデータ）** に以下を入力：
```
Q001	あなたの年代を教えてください	radio	20代,30代,40代,50代以上	true	1	true
Q002	興味のある分野を選択してください（複数選択可）	checkbox	IT,医療,教育,環境,その他	true	2	true
Q003	当システムの利用頻度を教えてください	radio	毎日,週に数回,月に数回,初回	true	3	true
Q004	改善してほしい点があればお聞かせください	text		false	4	true
Q005	今後期待する機能を選択してください（複数選択可）	checkbox	モバイル対応,レポート機能,通知機能,API連携	false	5	true
```

### 2-3. 回答データシートの設定

1. **1行目（ヘッダー行）** に以下を入力：
```
会員番号	設問ID	回答内容	回答日時
```

2. **2行目以降** は空白のまま（回答時に自動追加されます）

---

## Step 3: Google Apps Scriptの設定

### 3-1. Apps Scriptエディタを開く
1. スプレッドシートの「**拡張機能**」メニューをクリック
2. 「**Apps Script**」を選択
3. 新しいタブでApps Scriptエディタが開きます

### 3-2. Code.gsファイルの設定
1. デフォルトの`myFunction`を **すべて削除**
2. 提供された`Code.gs`の内容を **すべて貼り付け**
3. `Ctrl + S`でファイルを保存

### 3-3. form.htmlファイルの作成
1. 左側メニューの「**+**」ボタンをクリック
2. 「**HTMLファイル**」を選択
3. ファイル名を「**form**」に設定
4. デフォルトの内容を **すべて削除**
5. 提供された`form.html`の内容を **すべて貼り付け**
6. `Ctrl + S`でファイルを保存

### 3-4. プロジェクト名の設定
1. 左上の「**無題のプロジェクト**」をクリック
2. 「**アンケート調査システム**」に変更
3. 保存ボタンをクリック

---

## Step 4: ウェブアプリとしてデプロイ

### 4-1. デプロイの実行
1. 右上の「**デプロイ**」ボタンをクリック
2. 「**新しいデプロイ**」を選択

### 4-2. デプロイ設定
1. **種類**: 「ウェブアプリ」を選択
2. **説明**: 「アンケート調査システム v1.0」
3. **実行者**: 「自分（your-email@example.com）」
4. **アクセスできるユーザー**: 「全員」を選択

### 4-3. 承認プロセス
1. 「**デプロイ**」ボタンをクリック
2. 「**アクセスを承認**」をクリック
3. Googleアカウントを選択
4. 「**詳細**」→「**アンケート調査システム（安全ではないページ）に移動**」をクリック
5. 「**許可**」をクリック

### 4-4. ウェブアプリURLの取得
1. デプロイ完了後、**ウェブアプリのURL**をコピー
2. 安全な場所に保存（このURLがアンケートシステムのアクセスURLになります）

---

## Step 5: 動作確認

### 5-1. 基本動作テスト
1. 取得したウェブアプリURLにアクセス
2. ログイン画面が表示されることを確認

### 5-2. ログイン機能のテスト
1. **会員番号**: `M001`
2. **パスワード**: `pass123`
3. 「ログイン」ボタンをクリック
4. 会員情報画面が表示されることを確認

### 5-3. アンケート機能のテスト
1. 会員情報を確認・編集
2. 「アンケートに進む」をクリック
3. 設問が正しく表示されることを確認
4. 各設問タイプ（ラジオボタン、チェックボックス、テキスト）に回答
5. 「確認画面へ」をクリック

### 5-4. 確認・送信機能のテスト
1. 確認画面で回答内容を確認
2. 「この内容で送信」をクリック
3. 完了画面が表示されることを確認

### 5-5. データ保存の確認
1. スプレッドシートに戻る
2. 「**回答データ**」シートで回答が保存されていることを確認
3. 「**会員データ**」シートで最終送信日時が更新されていることを確認

---

## 運用開始後の管理

### 設問の追加・変更
1. 「**設問管理**」シートで設問を追加・編集
2. 表示フラグで設問の表示・非表示を制御
3. 変更後、システムの再デプロイは不要

### 会員の追加
1. 「**会員データ**」シートに新しい行を追加
2. 会員番号（ユニーク）とパスワードを設定

### データの分析
1. 「**回答データ**」シートからデータをエクスポート
2. Google Data StudioやExcelで分析

---

## トラブルシューティング

### ❌ ログインできない
- **原因**: 会員番号・パスワードの不一致
- **対策**: 会員データシートの内容を確認

### ❌ 設問が表示されない
- **原因**: 設問管理シートの設定ミス
- **対策**: 表示フラグが`true`になっているか確認

### ❌ 「権限がありません」エラー
- **原因**: スプレッドシートの権限設定
- **対策**: スプレッドシートを「リンクを知っている全員が編集可」に設定

### ❌ データが保存されない
- **原因**: Apps Scriptの実行権限
- **対策**: 再度承認プロセスを実行

### ❌ 「スプレッドシートが見つかりません」エラー
- **原因**: スプレッドシート名の不一致
- **対策**: スプレッドシート名が「アンケート調査システム」になっているか確認

---

## 📞 サポート情報

### ドキュメント
- `仕様書.md`: 技術仕様詳細
- `システム概要.md`: システムの特徴と活用方法
- `設問表示制御機能詳細.md`: 表示・非表示機能の詳細

### セキュリティ注意事項
- パスワードは平文保存のため、機密情報には使用しない
- ウェブアプリURLの管理に注意
- 本格運用時はGoogle Workspaceの利用を推奨

---

## ✅ 導入完了チェックリスト

- [ ] スプレッドシート「アンケート調査システム」を作成
- [ ] 3つのシート（会員データ、設問管理、回答データ）を作成
- [ ] 各シートにヘッダー行とサンプルデータを入力
- [ ] Code.gsファイルを作成・貼り付け
- [ ] form.htmlファイルを作成・貼り付け
- [ ] ウェブアプリとしてデプロイ
- [ ] 承認プロセスを完了
- [ ] ウェブアプリURLを取得・保存
- [ ] ログイン機能をテスト
- [ ] アンケート機能をテスト
- [ ] データ保存をテスト
- [ ] 運用開始

**🎉 おめでとうございます！アンケート調査システムの導入が完了しました！**

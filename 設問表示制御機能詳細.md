# 設問表示・非表示制御機能 - 詳細説明書

## 🎯 機能概要
設問管理シートの「表示フラグ」列により、各設問の表示・非表示を動的に制御する機能です。プログラムの修正なしに、スプレッドシートの設定変更のみで設問の有効/無効を切り替えることができます。

## 🔧 設定方法

### 1. 表示フラグの設定値
| 設定値  | 動作   | 説明                                   |
| ------- | ------ | -------------------------------------- |
| `true`  | 表示   | 設問を表示し、回答可能にする           |
| `false` | 非表示 | 設問を非表示にし、回答画面に表示しない |
| 空白    | 表示   | `true`と同じ動作（デフォルト）         |

### 2. 設定手順
1. Googleスプレッドシートの「設問管理」シートを開く
2. G列（表示フラグ）で制御したい設問の行を選択
3. セルに`true`（表示）または`false`（非表示）を入力
4. 変更を保存（自動保存）
5. アンケートページをリロードして反映確認

## 📊 活用シーン

### 1. 季節限定アンケート
```
例：年末年始に関する設問
Q010  今年の満足度を教えてください  radio  とても満足,満足,普通,不満,とても不満  true  10  true  ← 12月のみtrue
```

### 2. イベント関連設問
```
例：学会参加後のフィードバック
Q020  学会の満足度はいかがでしたか  radio  とても良い,良い,普通,悪い  true  20  false  ← イベント後にtrue
```

### 3. テスト設問
```
例：新機能のフィードバック（テスト中）
Q030  新機能についてご意見ください  text     false  30  false  ← テスト期間中のみtrue
```

### 4. A/Bテスト
```
グループAの設問：
Q040  プランAについて評価してください  radio  良い,普通,悪い  true  40  true   ← グループAのみ

グループBの設問：
Q041  プランBについて評価してください  radio  良い,普通,悪い  true  41  false  ← グループBのみ
```

## ⚙️ 技術仕様

### データフロー
```
スプレッドシート（設問管理シート）
↓ getQuestionData()関数で読み込み
Apps Script（表示フラグをチェック）
↓ 表示対象の設問のみを抽出
フロントエンド（動的設問表示）
```

### 判定ロジック
```javascript
// Code.gsの実装部分
const isVisible = data[i][6] === true || data[i][6] === 'true' || data[i][6] === undefined || data[i][6] === '';

if (!isVisible) {
  continue; // 非表示設問はスキップ
}
```

## 📋 運用のベストプラクティス

### 1. 設問IDの管理
- 非表示設問も設問IDは保持されるため、一意性を維持
- 将来的に再表示する可能性がある設問は削除せず非表示設定

### 2. 回答データの整合性
- 非表示期間中の回答は記録されない
- 過去の回答データは設問非表示後も保持される
- 分析時は表示期間を考慮した集計が必要

### 3. 変更管理
- 表示フラグ変更時は管理者間で共有
- 重要な設問の非表示設定は慎重に実施
- 定期的な設問一覧の見直し

## 🔍 確認方法

### 1. 設問表示の確認
1. 管理者でアンケートページにアクセス
2. 非表示設定した設問が表示されないことを確認
3. 他の設問に影響がないことを確認

### 2. データ保存の確認
1. テスト回答を実施
2. 回答データシートで非表示設問の回答が記録されないことを確認
3. 表示設問の回答は正常に保存されることを確認

## ⚠️ 注意事項

### 設問の非表示化による影響
- **必須設問を非表示にした場合**: バリデーションエラーが発生しないよう、必須フラグも合わせて確認
- **参照される設問**: 他の設問で選択肢として参照されている場合は注意
- **分析への影響**: 過去データとの比較分析時に期間を考慮

### 推奨しない操作
- ❌ 必須設問の突然の非表示化
- ❌ 回答期間中の頻繁な表示/非表示切り替え
- ❌ 設問IDの重複（非表示設問含む）

## 📈 応用例

### 動的アンケートシステム
```
基本設問: 常時表示
Q001-Q010: 基本情報・満足度（常にtrue）

条件付き設問: 特定期間のみ表示
Q011-Q020: 季節限定（春：true、他：false）
Q021-Q030: イベント関連（イベント時：true、他：false）

実験的設問: テスト期間のみ表示
Q031-Q040: 新機能評価（テスト期間：true、他：false）
```

この機能により、アンケートシステムが静的なものから動的で柔軟なシステムに進化し、様々なニーズに対応できるようになります。

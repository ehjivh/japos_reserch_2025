# アンケート回答データ可視化システム 仕様書

## 📊 システム概要

### 目的
既存のアンケート調査システムで収集された回答データを、設問タイプに応じて適切なグラフで可視化し、データの分析・理解を支援する。

### 基本方針
- Google Apps Script（GAS）ベースで開発
- 既存のスプレッドシートデータを活用
- 設問タイプ（radio、checkbox、text）に応じた最適なグラフを自動生成
- ウェブアプリケーションとして提供
- 管理者が簡単にアクセス・操作可能

## 🎯 機能要件

### 1. 基本機能

#### 1.1 データ取得機能
- **設問管理シートからの設問情報取得**
  - 設問ID、設問タイトル、設問タイプ、選択肢の取得
  - 表示フラグによる有効設問の絞り込み
  
- **回答データシートからの回答データ取得**
  - 会員別回答データの取得
  - 集計対象データの抽出
  - 欠損値・無効値の除外

#### 1.2 グラフ生成機能

##### ラジオボタン設問（単一選択）
- **円グラフ（Pie Chart）**
  - 各選択肢の選択率を円グラフで表示
  - パーセンテージ表示
  - 色分けによる視覚的な区別

- **棒グラフ（Bar Chart）**
  - 各選択肢の回答数を棒グラフで表示
  - 横軸：選択肢、縦軸：回答数
  - 実数とパーセンテージの両方表示

##### チェックボックス設問（複数選択）
- **棒グラフ（Bar Chart）**
  - 各選択肢の選択頻度を表示
  - 複数選択のため、合計が100%を超える場合がある
  - 選択肢別の人気度が分かる

- **積み上げ棒グラフ（Stacked Bar Chart）**
  - 選択パターンの組み合わせを表示
  - よく一緒に選ばれる選択肢の傾向を把握

##### テキスト設問（自由記述）
- **ワードクラウド**
  - 頻出キーワードの可視化
  - 文字の大きさで頻度を表現

- **回答長分布グラフ**
  - 回答の文字数分布をヒストグラムで表示
  - 回答の詳細度を把握

- **回答一覧テーブル**
  - 全回答の一覧表示
  - 検索・フィルタ機能

#### 1.3 統計情報表示機能
- **基本統計**
  - 総回答数
  - 回答率（有効回答/総会員数）
  - 設問別回答率

- **詳細統計**
  - 設問タイプ別の回答傾向
  - 時系列での回答状況
  - 会員属性別のクロス集計（性別、所属等）

### 2. ユーザーインターフェース

#### 2.1 メイン画面
- **ダッシュボード形式**
  - システム全体の概要表示
  - 各設問のサマリーグラフ
  - 最新の統計情報

#### 2.2 設問別詳細画面
- **設問選択メニュー**
  - 設問一覧からの選択
  - 設問タイプ別フィルタ

- **グラフ表示エリア**
  - 設問タイプに応じたグラフの自動表示
  - グラフの切り替え機能（円グラフ⇔棒グラフ等）
  - 拡大表示機能

#### 2.3 データエクスポート機能
- **画像エクスポート**
  - グラフをPNG形式でダウンロード
  - 報告書作成時の素材として活用

- **データエクスポート**
  - 集計データをCSV形式でエクスポート
  - Excel等での詳細分析用

## 📋 技術仕様

### 3.1 システム構成
```
[フロントエンド]
visualization.html (HTML/CSS/JavaScript)
├── Chart.js（グラフライブラリ）
├── Bootstrap（UIフレームワーク）
└── jQuery（DOM操作）
↓
[バックエンド]
visualization.gs (Google Apps Script)
├── データ取得関数
├── データ集計関数
└── グラフデータ生成関数
↓
[データソース]
既存スプレッドシート
├── 会員データシート
├── 設問管理シート
└── 回答データシート
```

### 3.2 ファイル構成
```
visualization/
├── 可視化システム仕様書.md        （この文書）
├── visualization.gs              （GASメインスクリプト）
├── visualization.html             （フロントエンドHTML）
├── README.md                     （導入・使用方法）
└── サンプルデータ分析レポート.md   （活用例）
```

### 3.3 データフロー
1. **設問情報の取得**：設問管理シートから有効な設問一覧を取得
2. **回答データの取得**：回答データシートから回答を取得
3. **データの前処理**：欠損値処理、データ型変換
4. **設問タイプ別集計**：各設問タイプに応じた集計処理
5. **グラフデータ生成**：Chart.js用のデータ形式に変換
6. **グラフ描画**：フロントエンドでのグラフ表示

### 3.4 使用ライブラリ
- **Chart.js**: グラフ描画（円グラフ、棒グラフ、ヒストグラム）
- **WordCloud.js**: ワードクラウド生成
- **Bootstrap**: レスポンシブUIフレームワーク
- **jQuery**: DOM操作とAjax通信

## 📊 グラフ仕様詳細

### 4.1 ラジオボタン設問のグラフ

#### 円グラフ
- **用途**: 全体に対する各選択肢の割合を視覚的に表現
- **表示項目**: 
  - 選択肢名
  - 回答数
  - パーセンテージ
- **色分け**: 自動的に異なる色を割り当て
- **インタラクション**: クリックで詳細情報表示

#### 棒グラフ
- **用途**: 各選択肢の回答数の比較
- **軸設定**:
  - X軸: 選択肢名
  - Y軸: 回答数
- **表示**: 棒の上に具体的な数値を表示

### 4.2 チェックボックス設問のグラフ

#### 棒グラフ
- **特徴**: 複数選択可能なため、合計が総回答数を超える
- **表示**: 各選択肢の選択された回数
- **ソート**: 選択数の多い順に表示

#### 積み上げ棒グラフ
- **用途**: 選択肢の組み合わせパターンを表示
- **表示方法**: よく選ばれる組み合わせを色分けして表示

### 4.3 テキスト設問の可視化

#### ワードクラウド
- **前処理**: 
  - ストップワード除去（「です」「ます」等）
  - 品詞分析による名詞・形容詞の抽出
- **表示**: 出現頻度に応じた文字サイズ
- **色分け**: 頻度に応じたグラデーション

#### 回答長分布
- **X軸**: 文字数（範囲指定）
- **Y軸**: 該当する回答の数
- **ビン**: 50文字単位での区分

#### 回答一覧
- **テーブル形式**: 会員番号、回答内容、回答日時
- **機能**: 
  - キーワード検索
  - 文字数でのフィルタ
  - 日付でのソート

## 🔧 運用要件

### 5.1 パフォーマンス要件
- **データ読み込み時間**: 1000件以下の回答で5秒以内
- **グラフ描画時間**: 2秒以内
- **対応ブラウザ**: Chrome、Firefox、Edge、Safari最新版

### 5.2 セキュリティ要件
- **アクセス制御**: 管理者のみアクセス可能（既存システムと同様）
- **データ保護**: 回答内容の匿名化オプション
- **ログ記録**: アクセスログの記録

### 5.3 互換性要件
- **既存システムとの連携**: データ構造の変更なし
- **スプレッドシート形式**: 既存の3シート構成を維持
- **バックワード互換性**: 既存の回答データをすべて可視化可能

## 📈 拡張計画

### 6.1 フェーズ1（基本実装）
- 基本的なグラフ生成機能
- 設問タイプ別の適切なグラフ表示
- シンプルなUI

### 6.2 フェーズ2（機能拡張）
- 時系列分析機能
- 会員属性別クロス集計
- データエクスポート機能

### 6.3 フェーズ3（高度な分析）
- 回答パターン分析
- 予測分析機能
- 自動レポート生成

## 💡 活用シーン

### 研究機関
- **調査結果報告書**への図表挿入
- **学会発表**でのデータ可視化
- **研究論文**の図表作成

### 企業組織
- **経営陣への報告**資料作成
- **改善提案書**のエビデンス
- **定期レビュー**での傾向把握

### 一般利用
- **イベント参加者**へのフィードバック
- **会員向け報告書**の作成
- **運営改善**の意思決定支援

## 📋 開発タスク

### 7.1 準備フェーズ
- [ ] 既存システムの詳細分析
- [ ] サンプルデータでの動作確認
- [ ] ライブラリの選定と導入

### 7.2 開発フェーズ
- [ ] バックエンド（visualization.gs）の実装
- [ ] フロントエンド（visualization.html）の実装
- [ ] グラフ生成機能の実装
- [ ] UI/UXの調整

### 7.3 テストフェーズ
- [ ] 機能テスト
- [ ] パフォーマンステスト
- [ ] ブラウザ互換性テスト

### 7.4 デプロイフェーズ
- [ ] ウェブアプリとしてデプロイ
- [ ] 管理者向けマニュアル作成
- [ ] 運用テスト

## 📅 開発スケジュール

- **仕様書作成**: 1日
- **基本実装**: 3-5日
- **テスト・調整**: 2-3日
- **ドキュメント作成**: 1日
- **総開発期間**: 7-10日

---

*作成日: 2025年7月21日*
*バージョン: 1.0*
*対象システム: アンケート調査システム*
